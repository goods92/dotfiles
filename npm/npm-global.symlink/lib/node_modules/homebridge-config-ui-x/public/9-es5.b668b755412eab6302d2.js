!function(){function n(n,t){for(var l=0;l<t.length;l++){var e=t[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}}function t(t,l,e){return l&&n(t.prototype,l),e&&n(t,e),t}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{xs27:function(n,e,i){"use strict";i.r(e),i.d(e,"DockerModuleNgFactory",(function(){return U}));var u=i("8Y7J"),r=function n(){l(this,n)},a=i("9AJC"),o=i("uA2L"),s=i("Xfmu"),c=i("oEX9"),d=i("1Fu1"),p=i("pMnS"),m=i("i/5A"),h=i("s7LF"),f=i("jgx/"),v=i("TSSN"),g=i("SVse"),w=i("mrSG"),b=i("Vurf"),k=i("HyEY"),_=i("rVO2"),y=i("4MJ8"),I=function(){function n(t,e,i,u,r,a,o){l(this,n),this.$auth=t,this.$api=e,this.$md=i,this.$monacoEditor=u,this.$toastr=r,this.translate=a,this.$route=o,this.isMobile=!1,this.options={printMargin:!1},this.editorOptions={language:"shell",theme:this.$auth.theme.startsWith("dark-mode")?"vs-dark":"vs-light",automaticLayout:!0},this.isMobile=this.$md.detect.mobile()}return t(n,[{key:"ngOnInit",value:function(){var n=this;this.visualViewPortEventCallback=function(){return n.visualViewPortChanged()},this.lastHeight=window.innerHeight,window.visualViewport&&!this.isMobile&&(window.visualViewport.addEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.disableTouchMove()),this.$route.data.subscribe((function(t){n.startupScript=t.startupScript.script})),this.monacoEditorModel={value:"",language:"shell"}}},{key:"onEditorInit",value:function(n){this.monacoEditor=n,this.monacoEditor.getModel().setValue(this.startupScript)}},{key:"onSave",value:function(){return Object(w.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.saveInProgress){n.next=19;break}if(this.saveInProgress=!0,n.t0=this.isMobile,n.t0){n.next=7;break}return n.next=6,this.monacoEditor.getAction("editor.action.formatDocument").run();case 6:this.startupScript=this.monacoEditor.getModel().getValue();case 7:if("#!/bin/sh"===this.startupScript.split("\n")[0].trim()){n.next=9;break}return n.abrupt("return",(this.$toastr.error(this.translate.instant("platform.docker.startup_script.toast_script_must_use_hashbang"),this.translate.instant("platform.docker.startup_script.toast_title_script_error")),this.startupScript="#!/bin/sh\n\n"+this.startupScript,this.isMobile||this.monacoEditor.getModel().setValue(this.startupScript),void(this.saveInProgress=!1)));case 9:return n.prev=9,n.next=12,this.$api.put("/platform-tools/docker/startup-script",{script:this.startupScript}).toPromise();case 12:this.$toastr.success(this.translate.instant("platform.docker.startup_script.toast_restart_required"),this.translate.instant("platform.docker.startup_script.toast_title_script_saved")),n.next=18;break;case 15:n.prev=15,n.t1=n.catch(9),this.$toastr.error(n.t1.message,this.translate.instant("toast.title_error"));case 18:this.saveInProgress=!1;case 19:case"end":return n.stop()}}),n,this,[[9,15]])})))}},{key:"visualViewPortChanged",value:function(){this.lastHeight<window.visualViewport.height&&document.activeElement.blur(),window.visualViewport.height<window.innerHeight?(this.$md.enableTouchMove(),this.lastHeight=window.visualViewport.height):window.visualViewport.height===window.innerHeight&&(this.$md.disableTouchMove(),this.lastHeight=window.visualViewport.height)}},{key:"ngOnDestroy",value:function(){window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.enableTouchMove()),this.monacoEditor&&this.monacoEditor.dispose()}}]),n}(),C=i("EApP"),$=i("iInd"),R=u["\u0275crt"]({encapsulation:0,styles:[[""]],data:{}});function M(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,0,"i",[["class","fas fa-spinner fa-pulse"]],null,null,null,null,null))],null,null)}function x(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,2,"ngx-monaco-editor",[["class","flex-grow-1 h-100 w-100 mb-3 mt-3"]],null,[[null,"onInit"],[null,"keydown.control.s"],[null,"keydown.meta.s"]],(function(n,t,l){var e=!0,i=n.component;return"onInit"===t&&(e=!1!==i.onEditorInit(l)&&e),"keydown.control.s"===t&&(l.preventDefault(),e=!1!==i.onSave()&&e),"keydown.meta.s"===t&&(l.preventDefault(),e=!1!==i.onSave()&&e),e}),m.c,m.a)),u["\u0275prd"](5120,null,h.n,(function(n){return[n]}),[f.a]),u["\u0275did"](2,4374528,null,0,f.a,[u.NgZone,f.c],{options:[0,"options"],model:[1,"model"]},{onInit:"onInit"})],(function(n,t){var l=t.component;n(t,2,0,l.editorOptions,l.monacoEditorModel)}),null)}function E(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,6,"textarea",[["autocapitalize","off"],["autocomplete","off"],["autocorrect","off"],["class","hb-plain-text-editor align-self-end h-100 w-100 mb-3 mt-3"],["spellcheck","false"],["wrap","off"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(n,t,l){var e=!0,i=n.component;return"input"===t&&(e=!1!==u["\u0275nov"](n,1)._handleInput(l.target.value)&&e),"blur"===t&&(e=!1!==u["\u0275nov"](n,1).onTouched()&&e),"compositionstart"===t&&(e=!1!==u["\u0275nov"](n,1)._compositionStart()&&e),"compositionend"===t&&(e=!1!==u["\u0275nov"](n,1)._compositionEnd(l.target.value)&&e),"ngModelChange"===t&&(e=!1!==(i.startupScript=l)&&e),e}),null,null)),u["\u0275did"](1,16384,null,0,h.d,[u.Renderer2,u.ElementRef,[2,h.a]],null,null),u["\u0275prd"](1024,null,h.n,(function(n){return[n]}),[h.d]),u["\u0275did"](3,671744,null,0,h.s,[[8,null],[8,null],[8,null],[6,h.n]],{model:[0,"model"]},{update:"ngModelChange"}),u["\u0275prd"](2048,null,h.o,null,[h.s]),u["\u0275did"](5,16384,null,0,h.p,[[4,h.o]],null,null),(n()(),u["\u0275ted"](-1,null,["  "]))],(function(n,t){n(t,3,0,t.component.startupScript)}),(function(n,t){n(t,0,0,u["\u0275nov"](t,5).ngClassUntouched,u["\u0275nov"](t,5).ngClassTouched,u["\u0275nov"](t,5).ngClassPristine,u["\u0275nov"](t,5).ngClassDirty,u["\u0275nov"](t,5).ngClassValid,u["\u0275nov"](t,5).ngClassInvalid,u["\u0275nov"](t,5).ngClassPending)}))}function S(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,21,"div",[["class","flex-column d-flex align-items-stretch h-100"]],null,null,null,null,null)),(n()(),u["\u0275eld"](1,0,null,null,11,"div",[["class","row"]],null,null,null,null,null)),(n()(),u["\u0275eld"](2,0,null,null,4,"div",[["class","col-sm-8 d-none d-sm-block"]],null,null,null,null,null)),(n()(),u["\u0275eld"](3,0,null,null,3,"h3",[["class","primary-text m-0"]],null,null,null,null,null)),(n()(),u["\u0275eld"](4,0,null,null,1,"span",[["class","d-none d-md-inline"]],null,null,null,null,null)),(n()(),u["\u0275ted"](-1,null,["Docker Container"])),(n()(),u["\u0275ted"](-1,null,[" startup.sh"])),(n()(),u["\u0275eld"](7,0,null,null,5,"div",[["class","col-sm-4 text-right"]],null,null,null,null,null)),(n()(),u["\u0275eld"](8,0,null,null,4,"button",[["class","btn btn-primary waves-effect m-0"]],[[8,"disabled",0]],[[null,"click"]],(function(n,t,l){var e=!0;return"click"===t&&(e=!1!==n.component.onSave()&&e),e}),null,null)),(n()(),u["\u0275ted"](9,null,[" "," "])),u["\u0275pid"](131072,v.l,[v.m,u.ChangeDetectorRef]),(n()(),u["\u0275and"](16777216,null,null,1,null,M)),u["\u0275did"](12,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),u["\u0275eld"](13,0,null,null,4,"div",[["class","row mt-3"]],null,null,null,null,null)),(n()(),u["\u0275eld"](14,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(n()(),u["\u0275eld"](15,0,null,null,2,"div",[["class","alert alert-warning"],["role","alert"]],null,null,null,null,null)),u["\u0275did"](16,8536064,null,0,v.f,[v.m,u.ElementRef,u.ChangeDetectorRef],{translate:[0,"translate"]},null),(n()(),u["\u0275ted"](-1,null,[" This script will be executed each time the docker container starts. You can use this to install any extra packages your plugins may need such as ffmpeg or libpcap-dev. "])),(n()(),u["\u0275and"](16777216,null,null,1,null,x)),u["\u0275did"](19,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),u["\u0275and"](16777216,null,null,1,null,E)),u["\u0275did"](21,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,t){var l=t.component;n(t,12,0,l.saveInProgress),n(t,16,0,"platform.docker.startup_script.message_script_help"),n(t,19,0,!l.isMobile),n(t,21,0,l.isMobile)}),(function(n,t){n(t,8,0,t.component.saveInProgress),n(t,9,0,u["\u0275unv"](t,9,0,u["\u0275nov"](t,10).transform("form.button_save")))}))}var V=u["\u0275ccf"]("app-startup-script",I,(function(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,1,"app-startup-script",[],null,null,null,S,R)),u["\u0275did"](1,245760,null,0,I,[b.a,k.a,_.a,y.a,C.j,v.m,$.a],null,null)],(function(n,t){n(t,1,0)}),null)}),{},{},[]),T=i("GFsM"),D=i("vAZj"),P=i("+WIb"),L=function(){function n(t,e,i,u,r,a){l(this,n),this.$api=t,this.$ws=e,this.$auth=i,this.$toastr=u,this.translate=r,this.$router=a,this.io=this.$ws.connectToNamespace("status"),this.resp={},this.timeout=!1,this.error=!1}return t(n,[{key:"ngOnInit",value:function(){var n=this;this.io.connected.subscribe((function(){n.io.socket.emit("monitor-server-status"),n.$auth.getAppSettings().catch()})),this.$api.put("/platform-tools/docker/restart-container",{}).subscribe((function(t){n.resp=t,n.checkIfServerUp()}),(function(t){var l=n.translate.instant("restart.toast_server_restart_error");n.error=l+".",n.$toastr.error("".concat(l,": ").concat(t.message),n.translate.instant("toast.title_error"))}))}},{key:"checkIfServerUp",value:function(){var n=this;this.checkDelay=setTimeout((function(){n.io.socket.on("homebridge-status",(function(t){"up"===t.status&&(n.$toastr.success(n.translate.instant("platform.docker.restart_container.toast_container_restarted"),n.translate.instant("toast.title_success")),n.$router.navigate(["/"]))}))}),1e4),this.checkTimeout=setTimeout((function(){n.$toastr.warning(n.translate.instant("restart.toast_sever_restart_timeout"),n.translate.instant("toast.title_warning"),{timeOut:1e4}),n.timeout=!0}),6e4)}},{key:"ngOnDestroy",value:function(){this.io.end(),clearTimeout(this.checkDelay),clearTimeout(this.checkTimeout)}}]),n}(),j=u["\u0275crt"]({encapsulation:2,styles:[],data:{}});function N(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,1,"app-spinner",[],null,null,null,T.b,T.a)),u["\u0275did"](1,114688,null,0,D.a,[],null,null)],(function(n,t){n(t,1,0)}),null)}function O(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,2,"p",[["class","grey-text"]],null,null,null,null,null)),u["\u0275did"](1,8536064,null,0,v.f,[v.m,u.ElementRef,u.ChangeDetectorRef],{translate:[0,"translate"]},null),(n()(),u["\u0275ted"](-1,null,[" Please wait, this page will automatically redirect when the Homebridge is back online."]))],(function(n,t){n(t,1,0,"restart.message_please_wait_while_server_restarts")}),null)}function A(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,1,"p",[["class","grey-text"]],null,null,null,null,null)),(n()(),u["\u0275ted"](1,null,["",""]))],null,(function(n,t){n(t,1,0,t.component.error)}))}function H(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,8,"div",[],null,null,null,null,null)),(n()(),u["\u0275eld"](1,0,null,null,2,"p",[["class","grey-text"]],null,null,null,null,null)),u["\u0275did"](2,8536064,null,0,v.f,[v.m,u.ElementRef,u.ChangeDetectorRef],{translate:[0,"translate"]},null),(n()(),u["\u0275ted"](-1,null,[" Server restart is taking a long time. You may need to bring up the Docker container manually."])),(n()(),u["\u0275eld"](4,0,null,null,4,"p",[["class","primary-text"]],[[8,"innerHTML",1]],null,null,null,null)),u["\u0275pid"](131072,v.l,[v.m,u.ChangeDetectorRef]),(n()(),u["\u0275ted"](-1,null,["Make sure you're running the Docker container with "])),(n()(),u["\u0275eld"](7,0,null,null,1,"strong",[],null,null,null,null,null)),(n()(),u["\u0275ted"](-1,null,["--restart=always"]))],(function(n,t){n(t,2,0,"platform.docker.restart_container.message_server_taking_long_time_to_restart")}),(function(n,t){n(t,4,0,u["\u0275unv"](t,4,0,u["\u0275nov"](t,5).transform("platform.docker.restart_container.message_run_with_restart_always")))}))}function z(n){return u["\u0275vid"](0,[(n()(),u["\u0275and"](16777216,null,null,1,null,N)),u["\u0275did"](1,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),u["\u0275eld"](2,0,null,null,12,"div",[["class","row"]],null,null,null,null,null)),(n()(),u["\u0275eld"](3,0,null,null,11,"div",[["class","col-md-12 text-center"]],null,null,null,null,null)),(n()(),u["\u0275eld"](4,0,null,null,1,"h1",[["class","primary-text"]],null,null,null,null,null)),(n()(),u["\u0275eld"](5,0,null,null,0,"i",[["class","fab fa-docker"]],null,null,null,null,null)),(n()(),u["\u0275eld"](6,0,null,null,2,"h3",[["class","primary-text"]],null,null,null,null,null)),u["\u0275did"](7,8536064,null,0,v.f,[v.m,u.ElementRef,u.ChangeDetectorRef],{translate:[0,"translate"]},null),(n()(),u["\u0275ted"](-1,null,["Restarting Docker Container"])),(n()(),u["\u0275and"](16777216,null,null,1,null,O)),u["\u0275did"](10,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),u["\u0275and"](16777216,null,null,1,null,A)),u["\u0275did"](12,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),u["\u0275and"](16777216,null,null,1,null,H)),u["\u0275did"](14,16384,null,0,g.NgIf,[u.ViewContainerRef,u.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,t){var l=t.component;n(t,1,0,!l.error),n(t,7,0,"platform.docker.restart_container.title_restarting"),n(t,10,0,!l.timeout&&!l.error),n(t,12,0,l.error),n(t,14,0,l.timeout)}),null)}var F=u["\u0275ccf"]("app-container-restart",L,(function(n){return u["\u0275vid"](0,[(n()(),u["\u0275eld"](0,0,null,null,1,"app-container-restart",[],null,null,null,z,j)),u["\u0275did"](1,245760,null,0,L,[k.a,P.a,b.a,C.j,v.m,$.l],null,null)],(function(n,t){n(t,1,0)}),null)}),{},{},[]),G=i("G0yt"),J=i("areh"),q=function(){function n(t,e,i){l(this,n),this.$api=t,this.$toastr=e,this.$router=i}return t(n,[{key:"resolve",value:function(n,t){var l=this;return this.$api.get("/platform-tools/docker/startup-script").toPromise().catch((function(n){l.$toastr.error(n.message,"Failed to Load Startup Script"),l.$router.navigate(["/"])}))}}]),n}(),W=i("pKmL"),Y=function n(){l(this,n)},U=u["\u0275cmf"](r,[],(function(n){return u["\u0275mod"]([u["\u0275mpd"](512,u.ComponentFactoryResolver,u["\u0275CodegenComponentFactoryResolver"],[[8,[a.a,a.b,a.j,a.k,a.g,a.h,a.i,o.g,o.h,o.i,o.j,o.k,o.l,o.m,o.n,o.o,o.p,o.q,o.r,o.s,o.t,o.u,o.v,o.w,o.x,o.y,o.c,o.d,o.e,o.f,s.a,c.a,d.a,p.a,V,F]],[3,u.ComponentFactoryResolver],u.NgModuleRef]),u["\u0275mpd"](4608,g.NgLocalization,g.NgLocaleLocalization,[u.LOCALE_ID]),u["\u0275mpd"](4608,h.z,h.z,[]),u["\u0275mpd"](4608,h.f,h.f,[]),u["\u0275mpd"](4608,G.x,G.x,[u.ComponentFactoryResolver,u.Injector,G.vb,G.y]),u["\u0275mpd"](4608,J.c,J.c,[]),u["\u0275mpd"](5120,J.e,(function(){return[new J.j]}),[]),u["\u0275mpd"](4608,J.k,J.k,[]),u["\u0275mpd"](4608,J.d,J.d,[J.e,J.k]),u["\u0275mpd"](4608,v.i,v.h,[]),u["\u0275mpd"](4608,v.d,v.g,[]),u["\u0275mpd"](4608,v.k,v.e,[]),u["\u0275mpd"](4608,v.c,v.b,[]),u["\u0275mpd"](4608,v.m,v.m,[v.n,v.i,v.d,v.k,v.c,v.o,v.q,v.p,v.a]),u["\u0275mpd"](4608,q,q,[k.a,C.j,$.l]),u["\u0275mpd"](1073742336,g.CommonModule,g.CommonModule,[]),u["\u0275mpd"](1073742336,h.y,h.y,[]),u["\u0275mpd"](1073742336,h.l,h.l,[]),u["\u0275mpd"](1073742336,h.v,h.v,[]),u["\u0275mpd"](1073742336,f.b,f.b,[]),u["\u0275mpd"](1073742336,G.c,G.c,[]),u["\u0275mpd"](1073742336,G.g,G.g,[]),u["\u0275mpd"](1073742336,G.i,G.i,[]),u["\u0275mpd"](1073742336,G.m,G.m,[]),u["\u0275mpd"](1073742336,G.n,G.n,[]),u["\u0275mpd"](1073742336,G.t,G.t,[]),u["\u0275mpd"](1073742336,G.v,G.v,[]),u["\u0275mpd"](1073742336,G.z,G.z,[]),u["\u0275mpd"](1073742336,G.B,G.B,[]),u["\u0275mpd"](1073742336,G.G,G.G,[]),u["\u0275mpd"](1073742336,G.L,G.L,[]),u["\u0275mpd"](1073742336,G.O,G.O,[]),u["\u0275mpd"](1073742336,G.T,G.T,[]),u["\u0275mpd"](1073742336,G.bb,G.bb,[]),u["\u0275mpd"](1073742336,G.eb,G.eb,[]),u["\u0275mpd"](1073742336,G.hb,G.hb,[]),u["\u0275mpd"](1073742336,G.kb,G.kb,[]),u["\u0275mpd"](1073742336,G.W,G.W,[]),u["\u0275mpd"](1073742336,G.A,G.A,[]),u["\u0275mpd"](1073742336,v.j,v.j,[]),u["\u0275mpd"](1073742336,J.m,J.m,[]),u["\u0275mpd"](1073742336,J.l,J.l,[]),u["\u0275mpd"](1073742336,J.a,J.a,[]),u["\u0275mpd"](1073742336,W.a,W.a,[]),u["\u0275mpd"](1073742336,$.p,$.p,[[2,$.u],[2,$.l]]),u["\u0275mpd"](1073742336,Y,Y,[]),u["\u0275mpd"](1073742336,r,r,[]),u["\u0275mpd"](1024,$.j,(function(){return[[{path:"",redirectTo:"/",pathMatch:"full"},{path:"startup-script",component:I,resolve:{startupScript:q}},{path:"restart-container",component:L}]]}),[]),u["\u0275mpd"](256,v.q,void 0,[]),u["\u0275mpd"](256,v.o,void 0,[]),u["\u0275mpd"](256,v.p,void 0,[]),u["\u0275mpd"](256,v.a,void 0,[])])}))}}])}();