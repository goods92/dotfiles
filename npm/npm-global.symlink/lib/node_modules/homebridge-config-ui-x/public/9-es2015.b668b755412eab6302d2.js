(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{xs27:function(l,t,n){"use strict";n.r(t),n.d(t,"DockerModuleNgFactory",(function(){return U}));var e=n("8Y7J");class i{}var s=n("9AJC"),r=n("uA2L"),u=n("Xfmu"),a=n("oEX9"),o=n("1Fu1"),d=n("pMnS"),c=n("i/5A"),p=n("s7LF"),m=n("jgx/"),h=n("TSSN"),f=n("SVse"),g=n("mrSG"),v=n("Vurf"),w=n("HyEY"),b=n("rVO2"),k=n("4MJ8");class _{constructor(l,t,n,e,i,s,r){this.$auth=l,this.$api=t,this.$md=n,this.$monacoEditor=e,this.$toastr=i,this.translate=s,this.$route=r,this.isMobile=!1,this.options={printMargin:!1},this.editorOptions={language:"shell",theme:this.$auth.theme.startsWith("dark-mode")?"vs-dark":"vs-light",automaticLayout:!0},this.isMobile=this.$md.detect.mobile()}ngOnInit(){this.visualViewPortEventCallback=()=>this.visualViewPortChanged(),this.lastHeight=window.innerHeight,window.visualViewport&&!this.isMobile&&(window.visualViewport.addEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.disableTouchMove()),this.$route.data.subscribe(l=>{this.startupScript=l.startupScript.script}),this.monacoEditorModel={value:"",language:"shell"}}onEditorInit(l){this.monacoEditor=l,this.monacoEditor.getModel().setValue(this.startupScript)}onSave(){return Object(g.a)(this,void 0,void 0,(function*(){if(!this.saveInProgress){if(this.saveInProgress=!0,this.isMobile||(yield this.monacoEditor.getAction("editor.action.formatDocument").run(),this.startupScript=this.monacoEditor.getModel().getValue()),"#!/bin/sh"!==this.startupScript.split("\n")[0].trim())return this.$toastr.error(this.translate.instant("platform.docker.startup_script.toast_script_must_use_hashbang"),this.translate.instant("platform.docker.startup_script.toast_title_script_error")),this.startupScript="#!/bin/sh\n\n"+this.startupScript,this.isMobile||this.monacoEditor.getModel().setValue(this.startupScript),void(this.saveInProgress=!1);try{yield this.$api.put("/platform-tools/docker/startup-script",{script:this.startupScript}).toPromise(),this.$toastr.success(this.translate.instant("platform.docker.startup_script.toast_restart_required"),this.translate.instant("platform.docker.startup_script.toast_title_script_saved"))}catch(l){this.$toastr.error(l.message,this.translate.instant("toast.title_error"))}this.saveInProgress=!1}}))}visualViewPortChanged(){this.lastHeight<window.visualViewport.height&&document.activeElement.blur(),window.visualViewport.height<window.innerHeight?(this.$md.enableTouchMove(),this.lastHeight=window.visualViewport.height):window.visualViewport.height===window.innerHeight&&(this.$md.disableTouchMove(),this.lastHeight=window.visualViewport.height)}ngOnDestroy(){window.visualViewport&&(window.visualViewport.removeEventListener("resize",this.visualViewPortEventCallback,!0),this.$md.enableTouchMove()),this.monacoEditor&&this.monacoEditor.dispose()}}var y=n("EApP"),I=n("iInd"),C=e["\u0275crt"]({encapsulation:0,styles:[[""]],data:{}});function $(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,0,"i",[["class","fas fa-spinner fa-pulse"]],null,null,null,null,null))],null,null)}function R(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,2,"ngx-monaco-editor",[["class","flex-grow-1 h-100 w-100 mb-3 mt-3"]],null,[[null,"onInit"],[null,"keydown.control.s"],[null,"keydown.meta.s"]],(function(l,t,n){var e=!0,i=l.component;return"onInit"===t&&(e=!1!==i.onEditorInit(n)&&e),"keydown.control.s"===t&&(n.preventDefault(),e=!1!==i.onSave()&&e),"keydown.meta.s"===t&&(n.preventDefault(),e=!1!==i.onSave()&&e),e}),c.c,c.a)),e["\u0275prd"](5120,null,p.n,(function(l){return[l]}),[m.a]),e["\u0275did"](2,4374528,null,0,m.a,[e.NgZone,m.c],{options:[0,"options"],model:[1,"model"]},{onInit:"onInit"})],(function(l,t){var n=t.component;l(t,2,0,n.editorOptions,n.monacoEditorModel)}),null)}function M(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,6,"textarea",[["autocapitalize","off"],["autocomplete","off"],["autocorrect","off"],["class","hb-plain-text-editor align-self-end h-100 w-100 mb-3 mt-3"],["spellcheck","false"],["wrap","off"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(l,t,n){var i=!0,s=l.component;return"input"===t&&(i=!1!==e["\u0275nov"](l,1)._handleInput(n.target.value)&&i),"blur"===t&&(i=!1!==e["\u0275nov"](l,1).onTouched()&&i),"compositionstart"===t&&(i=!1!==e["\u0275nov"](l,1)._compositionStart()&&i),"compositionend"===t&&(i=!1!==e["\u0275nov"](l,1)._compositionEnd(n.target.value)&&i),"ngModelChange"===t&&(i=!1!==(s.startupScript=n)&&i),i}),null,null)),e["\u0275did"](1,16384,null,0,p.d,[e.Renderer2,e.ElementRef,[2,p.a]],null,null),e["\u0275prd"](1024,null,p.n,(function(l){return[l]}),[p.d]),e["\u0275did"](3,671744,null,0,p.s,[[8,null],[8,null],[8,null],[6,p.n]],{model:[0,"model"]},{update:"ngModelChange"}),e["\u0275prd"](2048,null,p.o,null,[p.s]),e["\u0275did"](5,16384,null,0,p.p,[[4,p.o]],null,null),(l()(),e["\u0275ted"](-1,null,["  "]))],(function(l,t){l(t,3,0,t.component.startupScript)}),(function(l,t){l(t,0,0,e["\u0275nov"](t,5).ngClassUntouched,e["\u0275nov"](t,5).ngClassTouched,e["\u0275nov"](t,5).ngClassPristine,e["\u0275nov"](t,5).ngClassDirty,e["\u0275nov"](t,5).ngClassValid,e["\u0275nov"](t,5).ngClassInvalid,e["\u0275nov"](t,5).ngClassPending)}))}function E(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,21,"div",[["class","flex-column d-flex align-items-stretch h-100"]],null,null,null,null,null)),(l()(),e["\u0275eld"](1,0,null,null,11,"div",[["class","row"]],null,null,null,null,null)),(l()(),e["\u0275eld"](2,0,null,null,4,"div",[["class","col-sm-8 d-none d-sm-block"]],null,null,null,null,null)),(l()(),e["\u0275eld"](3,0,null,null,3,"h3",[["class","primary-text m-0"]],null,null,null,null,null)),(l()(),e["\u0275eld"](4,0,null,null,1,"span",[["class","d-none d-md-inline"]],null,null,null,null,null)),(l()(),e["\u0275ted"](-1,null,["Docker Container"])),(l()(),e["\u0275ted"](-1,null,[" startup.sh"])),(l()(),e["\u0275eld"](7,0,null,null,5,"div",[["class","col-sm-4 text-right"]],null,null,null,null,null)),(l()(),e["\u0275eld"](8,0,null,null,4,"button",[["class","btn btn-primary waves-effect m-0"]],[[8,"disabled",0]],[[null,"click"]],(function(l,t,n){var e=!0;return"click"===t&&(e=!1!==l.component.onSave()&&e),e}),null,null)),(l()(),e["\u0275ted"](9,null,[" "," "])),e["\u0275pid"](131072,h.l,[h.m,e.ChangeDetectorRef]),(l()(),e["\u0275and"](16777216,null,null,1,null,$)),e["\u0275did"](12,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null),(l()(),e["\u0275eld"](13,0,null,null,4,"div",[["class","row mt-3"]],null,null,null,null,null)),(l()(),e["\u0275eld"](14,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(l()(),e["\u0275eld"](15,0,null,null,2,"div",[["class","alert alert-warning"],["role","alert"]],null,null,null,null,null)),e["\u0275did"](16,8536064,null,0,h.f,[h.m,e.ElementRef,e.ChangeDetectorRef],{translate:[0,"translate"]},null),(l()(),e["\u0275ted"](-1,null,[" This script will be executed each time the docker container starts. You can use this to install any extra packages your plugins may need such as ffmpeg or libpcap-dev. "])),(l()(),e["\u0275and"](16777216,null,null,1,null,R)),e["\u0275did"](19,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null),(l()(),e["\u0275and"](16777216,null,null,1,null,M)),e["\u0275did"](21,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(l,t){var n=t.component;l(t,12,0,n.saveInProgress),l(t,16,0,"platform.docker.startup_script.message_script_help"),l(t,19,0,!n.isMobile),l(t,21,0,n.isMobile)}),(function(l,t){l(t,8,0,t.component.saveInProgress),l(t,9,0,e["\u0275unv"](t,9,0,e["\u0275nov"](t,10).transform("form.button_save")))}))}function S(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,1,"app-startup-script",[],null,null,null,E,C)),e["\u0275did"](1,245760,null,0,_,[v.a,w.a,b.a,k.a,y.j,h.m,I.a],null,null)],(function(l,t){l(t,1,0)}),null)}var V=e["\u0275ccf"]("app-startup-script",_,S,{},{},[]),T=n("GFsM"),x=n("vAZj"),D=n("+WIb");class P{constructor(l,t,n,e,i,s){this.$api=l,this.$ws=t,this.$auth=n,this.$toastr=e,this.translate=i,this.$router=s,this.io=this.$ws.connectToNamespace("status"),this.resp={},this.timeout=!1,this.error=!1}ngOnInit(){this.io.connected.subscribe(()=>{this.io.socket.emit("monitor-server-status"),this.$auth.getAppSettings().catch()}),this.$api.put("/platform-tools/docker/restart-container",{}).subscribe(l=>{this.resp=l,this.checkIfServerUp()},l=>{const t=this.translate.instant("restart.toast_server_restart_error");this.error=t+".",this.$toastr.error(`${t}: ${l.message}`,this.translate.instant("toast.title_error"))})}checkIfServerUp(){this.checkDelay=setTimeout(()=>{this.io.socket.on("homebridge-status",l=>{"up"===l.status&&(this.$toastr.success(this.translate.instant("platform.docker.restart_container.toast_container_restarted"),this.translate.instant("toast.title_success")),this.$router.navigate(["/"]))})},1e4),this.checkTimeout=setTimeout(()=>{this.$toastr.warning(this.translate.instant("restart.toast_sever_restart_timeout"),this.translate.instant("toast.title_warning"),{timeOut:1e4}),this.timeout=!0},6e4)}ngOnDestroy(){this.io.end(),clearTimeout(this.checkDelay),clearTimeout(this.checkTimeout)}}var L=e["\u0275crt"]({encapsulation:2,styles:[],data:{}});function N(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,1,"app-spinner",[],null,null,null,T.b,T.a)),e["\u0275did"](1,114688,null,0,x.a,[],null,null)],(function(l,t){l(t,1,0)}),null)}function j(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,2,"p",[["class","grey-text"]],null,null,null,null,null)),e["\u0275did"](1,8536064,null,0,h.f,[h.m,e.ElementRef,e.ChangeDetectorRef],{translate:[0,"translate"]},null),(l()(),e["\u0275ted"](-1,null,[" Please wait, this page will automatically redirect when the Homebridge is back online."]))],(function(l,t){l(t,1,0,"restart.message_please_wait_while_server_restarts")}),null)}function O(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,1,"p",[["class","grey-text"]],null,null,null,null,null)),(l()(),e["\u0275ted"](1,null,["",""]))],null,(function(l,t){l(t,1,0,t.component.error)}))}function A(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,8,"div",[],null,null,null,null,null)),(l()(),e["\u0275eld"](1,0,null,null,2,"p",[["class","grey-text"]],null,null,null,null,null)),e["\u0275did"](2,8536064,null,0,h.f,[h.m,e.ElementRef,e.ChangeDetectorRef],{translate:[0,"translate"]},null),(l()(),e["\u0275ted"](-1,null,[" Server restart is taking a long time. You may need to bring up the Docker container manually."])),(l()(),e["\u0275eld"](4,0,null,null,4,"p",[["class","primary-text"]],[[8,"innerHTML",1]],null,null,null,null)),e["\u0275pid"](131072,h.l,[h.m,e.ChangeDetectorRef]),(l()(),e["\u0275ted"](-1,null,["Make sure you're running the Docker container with "])),(l()(),e["\u0275eld"](7,0,null,null,1,"strong",[],null,null,null,null,null)),(l()(),e["\u0275ted"](-1,null,["--restart=always"]))],(function(l,t){l(t,2,0,"platform.docker.restart_container.message_server_taking_long_time_to_restart")}),(function(l,t){l(t,4,0,e["\u0275unv"](t,4,0,e["\u0275nov"](t,5).transform("platform.docker.restart_container.message_run_with_restart_always")))}))}function H(l){return e["\u0275vid"](0,[(l()(),e["\u0275and"](16777216,null,null,1,null,N)),e["\u0275did"](1,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null),(l()(),e["\u0275eld"](2,0,null,null,12,"div",[["class","row"]],null,null,null,null,null)),(l()(),e["\u0275eld"](3,0,null,null,11,"div",[["class","col-md-12 text-center"]],null,null,null,null,null)),(l()(),e["\u0275eld"](4,0,null,null,1,"h1",[["class","primary-text"]],null,null,null,null,null)),(l()(),e["\u0275eld"](5,0,null,null,0,"i",[["class","fab fa-docker"]],null,null,null,null,null)),(l()(),e["\u0275eld"](6,0,null,null,2,"h3",[["class","primary-text"]],null,null,null,null,null)),e["\u0275did"](7,8536064,null,0,h.f,[h.m,e.ElementRef,e.ChangeDetectorRef],{translate:[0,"translate"]},null),(l()(),e["\u0275ted"](-1,null,["Restarting Docker Container"])),(l()(),e["\u0275and"](16777216,null,null,1,null,j)),e["\u0275did"](10,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null),(l()(),e["\u0275and"](16777216,null,null,1,null,O)),e["\u0275did"](12,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null),(l()(),e["\u0275and"](16777216,null,null,1,null,A)),e["\u0275did"](14,16384,null,0,f.NgIf,[e.ViewContainerRef,e.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(l,t){var n=t.component;l(t,1,0,!n.error),l(t,7,0,"platform.docker.restart_container.title_restarting"),l(t,10,0,!n.timeout&&!n.error),l(t,12,0,n.error),l(t,14,0,n.timeout)}),null)}function z(l){return e["\u0275vid"](0,[(l()(),e["\u0275eld"](0,0,null,null,1,"app-container-restart",[],null,null,null,H,L)),e["\u0275did"](1,245760,null,0,P,[w.a,D.a,v.a,y.j,h.m,I.l],null,null)],(function(l,t){l(t,1,0)}),null)}var F=e["\u0275ccf"]("app-container-restart",P,z,{},{},[]),G=n("G0yt"),J=n("areh");class q{constructor(l,t,n){this.$api=l,this.$toastr=t,this.$router=n}resolve(l,t){return this.$api.get("/platform-tools/docker/startup-script").toPromise().catch(l=>{this.$toastr.error(l.message,"Failed to Load Startup Script"),this.$router.navigate(["/"])})}}var W=n("pKmL");class Y{}var U=e["\u0275cmf"](i,[],(function(l){return e["\u0275mod"]([e["\u0275mpd"](512,e.ComponentFactoryResolver,e["\u0275CodegenComponentFactoryResolver"],[[8,[s.a,s.b,s.j,s.k,s.g,s.h,s.i,r.g,r.h,r.i,r.j,r.k,r.l,r.m,r.n,r.o,r.p,r.q,r.r,r.s,r.t,r.u,r.v,r.w,r.x,r.y,r.c,r.d,r.e,r.f,u.a,a.a,o.a,d.a,V,F]],[3,e.ComponentFactoryResolver],e.NgModuleRef]),e["\u0275mpd"](4608,f.NgLocalization,f.NgLocaleLocalization,[e.LOCALE_ID]),e["\u0275mpd"](4608,p.z,p.z,[]),e["\u0275mpd"](4608,p.f,p.f,[]),e["\u0275mpd"](4608,G.x,G.x,[e.ComponentFactoryResolver,e.Injector,G.vb,G.y]),e["\u0275mpd"](4608,J.c,J.c,[]),e["\u0275mpd"](5120,J.e,(function(){return[new J.j]}),[]),e["\u0275mpd"](4608,J.k,J.k,[]),e["\u0275mpd"](4608,J.d,J.d,[J.e,J.k]),e["\u0275mpd"](4608,h.i,h.h,[]),e["\u0275mpd"](4608,h.d,h.g,[]),e["\u0275mpd"](4608,h.k,h.e,[]),e["\u0275mpd"](4608,h.c,h.b,[]),e["\u0275mpd"](4608,h.m,h.m,[h.n,h.i,h.d,h.k,h.c,h.o,h.q,h.p,h.a]),e["\u0275mpd"](4608,q,q,[w.a,y.j,I.l]),e["\u0275mpd"](1073742336,f.CommonModule,f.CommonModule,[]),e["\u0275mpd"](1073742336,p.y,p.y,[]),e["\u0275mpd"](1073742336,p.l,p.l,[]),e["\u0275mpd"](1073742336,p.v,p.v,[]),e["\u0275mpd"](1073742336,m.b,m.b,[]),e["\u0275mpd"](1073742336,G.c,G.c,[]),e["\u0275mpd"](1073742336,G.g,G.g,[]),e["\u0275mpd"](1073742336,G.i,G.i,[]),e["\u0275mpd"](1073742336,G.m,G.m,[]),e["\u0275mpd"](1073742336,G.n,G.n,[]),e["\u0275mpd"](1073742336,G.t,G.t,[]),e["\u0275mpd"](1073742336,G.v,G.v,[]),e["\u0275mpd"](1073742336,G.z,G.z,[]),e["\u0275mpd"](1073742336,G.B,G.B,[]),e["\u0275mpd"](1073742336,G.G,G.G,[]),e["\u0275mpd"](1073742336,G.L,G.L,[]),e["\u0275mpd"](1073742336,G.O,G.O,[]),e["\u0275mpd"](1073742336,G.T,G.T,[]),e["\u0275mpd"](1073742336,G.bb,G.bb,[]),e["\u0275mpd"](1073742336,G.eb,G.eb,[]),e["\u0275mpd"](1073742336,G.hb,G.hb,[]),e["\u0275mpd"](1073742336,G.kb,G.kb,[]),e["\u0275mpd"](1073742336,G.W,G.W,[]),e["\u0275mpd"](1073742336,G.A,G.A,[]),e["\u0275mpd"](1073742336,h.j,h.j,[]),e["\u0275mpd"](1073742336,J.m,J.m,[]),e["\u0275mpd"](1073742336,J.l,J.l,[]),e["\u0275mpd"](1073742336,J.a,J.a,[]),e["\u0275mpd"](1073742336,W.a,W.a,[]),e["\u0275mpd"](1073742336,I.p,I.p,[[2,I.u],[2,I.l]]),e["\u0275mpd"](1073742336,Y,Y,[]),e["\u0275mpd"](1073742336,i,i,[]),e["\u0275mpd"](1024,I.j,(function(){return[[{path:"",redirectTo:"/",pathMatch:"full"},{path:"startup-script",component:_,resolve:{startupScript:q}},{path:"restart-container",component:P}]]}),[]),e["\u0275mpd"](256,h.q,void 0,[]),e["\u0275mpd"](256,h.o,void 0,[]),e["\u0275mpd"](256,h.p,void 0,[]),e["\u0275mpd"](256,h.a,void 0,[])])}))}}]);